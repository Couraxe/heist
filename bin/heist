#!/usr/bin/env ruby

require 'rubygems'
require 'oyster'

require File.dirname(__FILE__) + '/../lib/heist'

spec = Oyster.spec do
  name "heist -- Ruby-powered Scheme interpreter, v. #{Heist::VERSION}"
  author 'James Coglan <jcoglan@googlemail.com>'
  
  synopsis <<-EOS
    heist -i [OPTIONS]
    heist FILE_NAME [OPTIONS]
  EOS
  
  flag :interactive, :desc =>
        'Start an interactive Scheme session'
  
  string :order, :default => 'eager', :desc =>
        'Evaluation order, either "eager" or "lazy"'
end

begin
options = spec.parse
rescue Oyster::HelpRendered; exit
end

settings = {
  :order => Heist.const_get(options[:order].upcase)
}

if options[:interactive]
  Heist::REPL.new(settings).run
else
  env = Heist::Runtime.new(settings)
  env.run(File.expand_path(options[:unclaimed].first))
end

